## 图像数据处理

该类方法主要用于前后端图像传输，场景如下：

1. 基本前后端传输渲染
2. 将深度学习模型包装为web接口，需要传输数据并转化推理

图像的转化一定要注意色彩空间，

### 将本地图像加载到bytes数据

```python
import cv2 as cv


def get_img_byte(file_path = './data/img/test_tra_1.png'):
    # get img data
    img = cv.imread(file_path)
    
    # trans to bytes，".png"：指定编码格式，传入一个np.array，返回是否成功与编码图像
    success, encoded_image = cv.imencode(".png", img)
    # 将编码图像转化为bytes，使用tobytes方法。
    img_bytes = encoded_image.tobytes()
    
    return img_bytes
```

### 将bytes数据转化到图像实例对象

```python
from io import BytesIO
from PIL import Image

def get_img_by_bytes(img_bytes):
    img = Image.open(BytesIO(img_bytes))
    img = img.convert('RGB')
    return img

# res: <PIL.Image.Image image mode=RGB size=402x212 at 0x2938818EF70>
```

### 将pil.Image转化为ndarray

```python

import numpy as np

def img_to_np(img):
    return np.array(img)
```

### cv2转pil

**这里就存在色彩空间的变化，从BGR到RGB，opencv读取图像得到的图像是BGR的，而常用的matplotlib
，PIL.IMAGE等都是以RGB色彩空间的。**

```python
from cv2 import cvtColor, COLOR_BGR2RGB
from PIL import Image

def cv_to_pil(img):
    return Image.fromarray(cvtColor(img, COLOR_BGR2RGB))

```


### pil转cv2

```python
from numpy import array
from cv2 import cvtColor, COLOR_RGB2BGR

def pil_to_cv(pil):
    return cvtColor(array(pil), COLOR_RGB2BGR)

# res: A ndarray that supports OpencV
```